<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#059669">
<title>Score Board</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--j-dark:#064e3b;--j-primary:#059669;--j-light:#6ee7b7;--j-bg:#d1fae5;--brown:#92400e;--leaf:#10b981;--yellow:#fbbf24;--danger:#dc2626}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#059669 0%,#064e3b 50%,#065f46 100%);background-attachment:fixed;min-height:100vh;padding:12px;color:#1F2937}
.container{max-width:900px;margin:0 auto}

.header{background:rgba(255,255,255,.95);backdrop-filter:blur(20px);border-radius:20px;padding:24px;margin-bottom:20px;box-shadow:0 10px 40px rgba(6,78,59,.2);border:2px solid rgba(16,185,129,.3);text-align:center;}
.editable-h1 {width:100%; border:none; background:transparent; font-size:28px; font-weight:800; color:var(--j-dark); text-align:center; margin-bottom:16px; outline:none; font-family:inherit;}

.card{background:rgba(255,255,255,.95);backdrop-filter:blur(20px);border-radius:20px;padding:20px;margin-bottom:20px;box-shadow:0 8px 32px rgba(6,78,59,.15);border:1px solid rgba(16,185,129,.2)}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.controls input, .controls button{padding:12px 18px;border:2px solid rgba(16,185,129,.3);border-radius:14px;font-size:14px;font-weight:600;transition:all .2s;background:white}
.controls button{background:var(--j-primary);color:white;border:none;cursor:pointer;box-shadow:0 2px 8px rgba(5,150,105,.3)}
.controls button:hover{transform:translateY(-2px);background:var(--j-dark)}
.btn-success{background:var(--leaf)!important}
.btn-warning{background:var(--yellow)!important;color:var(--brown)!important}
.btn-danger{background:var(--danger)!important}

.player-card{background:rgba(255,255,255,.95);backdrop-filter:blur(20px);border-radius:18px;padding:20px;margin-bottom:16px;box-shadow:0 4px 20px rgba(6,78,59,.12);border-left:6px solid;transition:all .3s}
.player-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.player-name{font-size:20px;font-weight:700;color:var(--j-dark)}
.player-score{font-size:32px;font-weight:800;color:var(--j-primary)}
.status-badge{padding:6px 14px;border-radius:14px;font-size:13px;font-weight:700;color:white}
.status-in{background:var(--leaf)}
.status-out{background:var(--danger)}

.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(6,78,59,.9);backdrop-filter:blur(8px);overflow-y:auto;}
.modal-content{background:white;margin:5% auto;padding:32px;border-radius:24px;width:90%;max-width:700px;box-shadow:0 20px 60px rgba(0,0,0,.4)}

/* CERTIFICATE SCREENSHOT OPTIMIZATION */
.cert-viewport { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 10px; }
.cert-card { width: 100%; max-width: 600px; background: white; padding: 25px; border-radius: 5px; box-shadow: 0 0 30px rgba(0,0,0,0.5); position: relative; aspect-ratio: 1.41 / 1; }
.cert-inner { border: 5px double var(--j-primary); height: 100%; padding: 15px; text-align: center; display: flex; flex-direction: column; justify-content: center; }
.screenshot-hide { display: none !important; }
</style>
</head>
<body>

<div class="container">
    <div class="header">
        <input type="text" id="boardTitle" class="editable-h1" value="Score Board" onchange="pushUpdate()">
        <div id="roomDisplay" style="font-size: 12px; color: var(--leaf); margin-bottom: 10px;">üåç Live Sync: <b>Connecting...</b></div>
        
        <div class="controls">
            <input type="text" id="gameName" placeholder="Game Name" value="Rummy" style="flex:1" onchange="pushUpdate()">
            <label>Target:</label>
            <input type="number" id="targetPoint" value="330" style="width:80px" onchange="pushUpdate()">
            <button class="btn-warning" onclick="resetPoints()">üîÑ Reset</button>
            <button class="btn-success" onclick="showReport()">üìã Report</button>
        </div>
    </div>

    <div class="card">
        <div class="controls">
            <input type="text" id="newPlayerName" placeholder="Add Player Name" style="flex:1">
            <button class="btn-success" onclick="addPlayer()">‚ûï Add Player</button>
        </div>
    </div>

    <div id="playersList"></div>
</div>

<div id="reportModal" class="modal"></div>
<div id="certModal" class="modal"></div>

<script>
// FIREBASE CONFIGURATION
const firebaseConfig = {
    databaseURL: "https://monkey-scoreboard-default-rtdb.firebaseio.com/" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ROOM LOGIC
let roomId = localStorage.getItem('monkey_room') || prompt("Enter Room Name (to sync with friends):");
if(!roomId) roomId = "GeneralBoard";
localStorage.setItem('monkey_room', roomId);
document.getElementById('roomDisplay').innerHTML = `üåç Live Sync: <b>${roomId}</b>`;

const roomRef = db.ref('rooms/' + roomId);

let state = {
    title: "Score Board", // Default Name
    gameName: "Rummy",
    target: 330,
    players: []
};

// SYNC LISTENERS
roomRef.on('value', (snapshot) => {
    const data = snapshot.val();
    if(data) {
        state = data;
        if(document.activeElement.id !== 'boardTitle') document.getElementById('boardTitle').value = state.title;
        if(document.activeElement.id !== 'gameName') document.getElementById('gameName').value = state.gameName;
        if(document.activeElement.id !== 'targetPoint') document.getElementById('targetPoint').value = state.target;
        render();
    }
});

function pushUpdate() {
    state.title = document.getElementById('boardTitle').value;
    state.gameName = document.getElementById('gameName').value;
    state.target = parseInt(document.getElementById('targetPoint').value) || 330;
    roomRef.set(state);
}

// GAME LOGIC
function addPlayer() {
    const name = document.getElementById('newPlayerName').value.trim().toUpperCase();
    if(!name) return;
    if(!state.players) state.players = [];
    state.players.push({ name, scores: [0], id: Date.now() });
    document.getElementById('newPlayerName').value = '';
    pushUpdate();
}

function addScore(id) {
    const inp = document.getElementById(`sc-${id}`);
    const val = parseInt(inp.value);
    if(isNaN(val)) return;
    const p = state.players.find(x => x.id === id);
    if(!p.scores) p.scores = [];
    p.scores.push(val);
    inp.value = '';
    pushUpdate();
}

function resetPoints() {
    if(confirm("Clear scores for everyone in this room?")) {
        state.players.forEach(p => p.scores = [0]);
        pushUpdate();
    }
}

function getTotal(p) { 
    return (p.scores || []).reduce((a,b) => a + b, 0); 
}

function render() {
    const list = document.getElementById('playersList');
    if(!state.players) return list.innerHTML = "";
    
    // Sort: Lowest score at the top
    const sorted = [...state.players].sort((a,b) => getTotal(a) - getTotal(b));
    
    list.innerHTML = sorted.map(p => {
        const total = getTotal(p);
        const isOut = total >= state.target;
        return `
            <div class="player-card" style="border-left-color: ${isOut ? 'var(--danger)' : 'var(--j-primary)'}">
                <div class="player-header">
                    <span class="player-name">${p.name}</span>
                    <div style="text-align:right">
                        <div class="player-score">${total}</div>
                        <span class="status-badge ${isOut ? 'status-out' : 'status-in'}">${isOut ? 'OUT' : 'IN'}</span>
                    </div>
                </div>
                <div class="controls">
                    <input type="number" id="sc-${p.id}" placeholder="Points" style="flex:1">
                    <button class="btn-success" onclick="addScore(${p.id})">ADD</button>
                    <button class="btn-danger" style="padding: 12px" onclick="removePlayer(${p.id})">‚úï</button>
                </div>
                <div style="margin-top:12px; display:flex; flex-wrap:wrap; gap:6px">
                    ${(p.scores || []).map(s => `<span style="background:white; padding:4px 10px; border-radius:8px; font-size:13px; border:1px solid rgba(0,0,0,0.1); font-weight:600">${s}</span>`).join('')}
                </div>
            </div>
        `;
    }).join('');
}

function removePlayer(id) {
    if(confirm("Remove player?")) {
        state.players = state.players.filter(p => p.id !== id);
        pushUpdate();
    }
}

// REPORT & CERTIFICATE
function showReport() {
    const active = state.players.filter(p => getTotal(p) > 0);
    const w = active.length > 0 ? active.reduce((min, p) => getTotal(p) < getTotal(min) ? p : min) : null;
    const modal = document.getElementById('reportModal');
    modal.innerHTML = `
        <div class="modal-content" style="text-align:center">
            <h2 style="color:var(--j-primary)">üìä Standing Report</h2>
            <hr style="margin:20px 0; opacity:0.2">
            ${w ? `
                <div style="padding:25px; background:var(--j-bg); border-radius:20px; margin-bottom:20px">
                    <div style="font-size:50px">üèÜ</div>
                    <h3 style="font-size:24px; margin:10px 0">${w.name}</h3>
                    <p>Winning with <b>${getTotal(w)}</b> points</p>
                    <button class="btn-warning" style="margin-top:15px; width:100%" onclick="showCert()">Get Certificate</button>
                </div>
            ` : '<p>No data recorded.</p>'}
            <button class="btn-danger" style="width:100%; padding:15px" onclick="closeModal('reportModal')">Close</button>
        </div>
    `;
    modal.style.display = 'block';
}

function showCert() {
    const active = state.players.filter(p => getTotal(p) > 0);
    const w = active.reduce((min, p) => getTotal(p) < getTotal(min) ? p : min);
    const modal = document.getElementById('certModal');
    const date = new Date().toLocaleDateString();
    modal.innerHTML = `
        <div class="cert-viewport" id="certArea">
            <div id="certUI" style="margin-bottom:20px; display:flex; gap:10px">
                <button onclick="toggleScreenshotMode()" style="padding:12px 24px; background:var(--yellow); border:none; border-radius:12px; font-weight:bold;">üì∏ Screenshot Mode</button>
                <button onclick="closeModal('certModal')" style="padding:12px 24px; background:white; border:none; border-radius:12px; font-weight:bold;">‚úï Exit</button>
            </div>
            <div class="cert-card">
                <div class="cert-inner">
                    <h4 style="color:var(--j-primary); letter-spacing:3px; font-size:12px">UNIVERSE OF MONKEYS</h4>
                    <h1 style="margin:15px 0; font-size:22px; color:var(--j-dark)">WINNER CERTIFICATE</h1>
                    <h2 style="font-size:32px; color:var(--j-primary); border-bottom: 2px solid var(--j-primary); display:inline-block; margin:10px auto; padding:0 20px">${w.name}</h2>
                    <h3 style="color:var(--brown); margin:5px 0">${state.gameName.toUpperCase()} CHAMPION</h3>
                    <p style="margin-top:20px; font-size:12px; color:#666">Score: ${getTotal(w)} | Room: ${roomId} | Date: ${date}</p>
                </div>
                <div style="position:absolute; bottom:25px; right:25px; font-size:45px">ü•á</div>
            </div>
            <p id="ssTip" style="color:white; margin-top:20px; display:none; font-weight:bold">Tap screen to exit</p>
        </div>
    `;
    modal.style.display = 'block';
}

function toggleScreenshotMode() {
    const ui = document.getElementById('certUI');
    const tip = document.getElementById('ssTip');
    ui.classList.toggle('screenshot-hide');
    tip.style.display = ui.classList.contains('screenshot-hide') ? 'block' : 'none';
    document.getElementById('certArea').onclick = ui.classList.contains('screenshot-hide') ? toggleScreenshotMode : null;
}

function closeModal(id) { document.getElementById(id).style.display = 'none'; }
</script>
</body>
</html>
