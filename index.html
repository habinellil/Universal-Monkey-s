<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#10b981">
<title>Score Board Pro + Sound</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<style>
:root {
    --bg: #f8fafc;
    --card-bg: #ffffff;
    --primary: #10b981;
    --primary-dark: #059669;
    --secondary: #64748b;
    --dark: #1e293b;
    --danger: #ef4444;
    --warning: #f59e0b;
    --dealer-glow: #fef3c7;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }

body {
    font-family: 'Inter', -apple-system, system-ui, sans-serif;
    background-color: var(--bg);
    color: var(--dark);
    line-height: 1.5;
    padding: 16px;
}

.container { max-width: 600px; margin: 0 auto; }

.header {
    background: var(--dark);
    color: white;
    padding: 24px;
    border-radius: 24px;
    margin-bottom: 20px;
    box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
}

.editable-h1 {
    width: 100%; border: none; background: transparent;
    font-size: 24px; font-weight: 800; color: white;
    text-align: center; margin-bottom: 4px; outline: none;
}

.room-tag {
    display: inline-block;
    background: rgba(255,255,255,0.1);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 11px;
    color: var(--primary);
    margin-bottom: 12px;
}

.nav-tabs { display: flex; gap: 8px; justify-content: center; margin-top: 10px; }

.nav-btn {
    padding: 8px 16px; border: none; border-radius: 12px;
    background: rgba(255,255,255,0.1); color: white;
    font-weight: 600; cursor: pointer; font-size: 13px; transition: 0.2s;
}

.nav-btn.active { background: var(--primary); color: white; }

.card {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 20px;
    margin-bottom: 16px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
}

.controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }

input {
    padding: 12px 16px; border: 1px solid #e2e8f0;
    border-radius: 12px; font-size: 14px; outline: none; transition: 0.2s;
}

button {
    padding: 12px 20px; border: none; border-radius: 12px;
    font-weight: 700; cursor: pointer; transition: 0.2s; font-size: 14px;
}

.btn-primary { background: var(--primary); color: white; }
.btn-outline { background: #f1f5f9; color: var(--dark); }
.btn-danger { background: #fee2e2; color: var(--danger); }

.player-card {
    background: white; border-radius: 20px; padding: 20px;
    margin-bottom: 12px; border: 1px solid #e2e8f0;
    transition: 0.3s;
}

.is-dealer {
    border-color: var(--warning);
    background: var(--dealer-glow);
}

.player-header { display: flex; justify-content: space-between; align-items: center; }
.player-name { font-weight: 700; font-size: 18px; }
.player-score { font-size: 28px; font-weight: 900; color: var(--primary); }

.modal {
    display:none; position:fixed; z-index:100; left:0; top:0;
    width:100%; height:100%; background: rgba(15, 23, 42, 0.8);
    backdrop-filter: blur(4px);
}

.modal-content {
    background: white; margin: 20% auto; padding: 32px;
    border-radius: 24px; width: 90%; max-width: 400px; text-align: center;
}

/* Sound Toggle */
#soundToggle {
    position: fixed; bottom: 20px; right: 20px;
    background: var(--dark); color: white; border-radius: 50%;
    width: 45px; height: 45px; display: flex; align-items: center;
    justify-content: center; font-size: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<div class="container">
    <div class="header">
        <input type="text" id="boardTitle" class="editable-h1" value="Score Board" onchange="pushUpdate()">
        <center><div class="room-tag" id="roomDisplay">Connecting...</div></center>
        
        <div class="nav-tabs">
            <button class="nav-btn active" onclick="switchTab('game')">ðŸŽ® Game</button>
            <button class="nav-btn" onclick="switchTab('history')">ðŸ“œ History</button>
            <button class="nav-btn" onclick="switchTab('stats')">ðŸ“Š Stats</button>
        </div>
    </div>

    <div id="tab-game">
        <div class="card">
            <div class="controls">
                <input type="text" id="gameName" value="Rummy" style="flex:1">
                <input type="number" id="targetPoint" value="330" style="width:80px">
                <button class="btn-primary" onclick="pushUpdate()">ðŸ’¾ Save</button>
            </div>
            <div class="controls" style="margin-top:10px">
                <button class="btn-outline" style="flex:1" onclick="resetPoints()">ðŸ”„ Reset</button>
                <button class="btn-primary" style="flex:1; background:var(--warning)" onclick="showReport()">ðŸ“‹ Report</button>
            </div>
        </div>

        <div class="card">
            <div class="controls">
                <input type="text" id="newPlayerName" placeholder="Player Name" style="flex:1">
                <button class="btn-primary" onclick="addPlayer()">Add</button>
            </div>
        </div>
        <div id="playersList"></div>
    </div>

    <div id="tab-history" style="display:none"><div id="historyList"></div></div>
    <div id="tab-stats" style="display:none"><div id="statsList" style="display:grid; grid-template-columns:1fr 1fr; gap:12px"></div></div>
</div>

<div id="reportModal" class="modal"></div>

<button id="soundToggle" onclick="toggleMute()">ðŸ”Š</button>

<script>
// --- AUDIO SYSTEM ---
const sounds = {
    pop: new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3'),
    dealer: new Audio('https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3'),
    win: new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3')
};
let isMuted = false;
function playSfx(key) { if(!isMuted) sounds[key].play(); }
function toggleMute() {
    isMuted = !isMuted;
    document.getElementById('soundToggle').innerText = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
}

// --- FIREBASE & LOGIC ---
const firebaseConfig = { databaseURL: "https://monkey-scoreboard-default-rtdb.firebaseio.com/" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let roomId = localStorage.getItem('monkey_room') || prompt("Room Name:");
if(!roomId) roomId = "Home";
localStorage.setItem('monkey_room', roomId);
document.getElementById('roomDisplay').innerText = `ROOM: ${roomId}`;

const roomRef = db.ref('rooms/' + roomId);
const historyRef = db.ref('archives/' + roomId);

let state = { title: "Score Board", gameName: "Rummy", target: 330, players: [], currentDealerIndex: 0 };

roomRef.on('value', snap => { if(snap.val()) { state = snap.val(); render(); }});
historyRef.on('value', snap => { renderHistory(snap.val()); renderStats(snap.val()); });

function pushUpdate() {
    state.title = document.getElementById('boardTitle').value;
    state.gameName = document.getElementById('gameName').value;
    state.target = parseInt(document.getElementById('targetPoint').value) || 330;
    roomRef.set(state);
}

function switchTab(t) {
    playSfx('pop');
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    ['game','history','stats'].forEach(id => document.getElementById('tab-'+id).style.display = t==id?'block':'none');
}

function addPlayer() {
    const name = document.getElementById('newPlayerName').value.trim().toUpperCase();
    if(!name) return;
    if(!state.players) state.players = [];
    state.players.push({ name, scores: [0], id: Date.now() });
    document.getElementById('newPlayerName').value = '';
    playSfx('pop');
    pushUpdate();
}

function addScore(id) {
    const val = parseInt(document.getElementById(`sc-${id}`).value);
    if(isNaN(val)) return;
    const p = state.players.find(x => x.id === id);
    if(!p.scores) p.scores = [];
    p.scores.push(val);
    state.currentDealerIndex = (state.currentDealerIndex + 1) % state.players.length;
    
    playSfx('pop');
    setTimeout(() => playSfx('dealer'), 400); // Slight delay for dealer rotation sound
    pushUpdate();
}

function render() {
    const list = document.getElementById('playersList');
    if(!state.players) return;
    const sorted = [...state.players].sort((a,b) => (a.scores?a.scores.reduce((x,y)=>x+y,0):0) - (b.scores?b.scores.reduce((x,y)=>x+y,0):0));
    
    list.innerHTML = sorted.map(p => {
        const total = p.scores ? p.scores.reduce((a,b)=>a+b,0) : 0;
        const idx = state.players.findIndex(x => x.id === p.id);
        const isD = idx === state.currentDealerIndex;
        return `
            <div class="player-card ${isD?'is-dealer':''}">
                <div class="player-header">
                    <div>
                        <span class="player-name">${p.name}</span>
                        ${isD?'<span style="font-size:10px; color:var(--warning); font-weight:800; margin-left:5px">ðŸŽ´ DEALER</span>':''}
                    </div>
                    <div class="player-score">${total}</div>
                </div>
                <div class="controls">
                    <input type="number" id="sc-${p.id}" placeholder="Pts" style="flex:1">
                    <button class="btn-primary" onclick="addScore(${p.id})">ADD</button>
                </div>
            </div>`;
    }).join('');
}

function showReport() {
    playSfx('win');
    const winners = [...state.players].sort((a,b) => (a.scores?a.scores.reduce((x,y)=>x+y,0):0) - (b.scores?b.scores.reduce((x,y)=>x+y,0):0));
    const modal = document.getElementById('reportModal');
    modal.innerHTML = `
        <div class="modal-content">
            <h2>Leader: ${winners[0].name}</h2>
            <button class="btn-primary" style="width:100%; margin-top:15px" onclick="archiveGame()">Archive Win</button>
            <button class="btn-outline" style="width:100%; margin-top:8px" onclick="document.getElementById('reportModal').style.display='none'">Close</button>
        </div>`;
    modal.style.display = 'block';
}

function archiveGame() {
    const winners = [...state.players].sort((a,b) => (a.scores?a.scores.reduce((x,y)=>x+y,0):0) - (b.scores?b.scores.reduce((x,y)=>x+y,0):0));
    historyRef.push({ date: new Date().toLocaleDateString(), gameName: state.gameName, winner: winners[0].name });
    playSfx('win');
    alert("Saved!");
    document.getElementById('reportModal').style.display = 'none';
}

function renderHistory(data) {
    const list = document.getElementById('historyList');
    if(!data) return list.innerHTML = "No history.";
    list.innerHTML = Object.values(data).reverse().map(h => `<div class="card"><b>${h.winner}</b> won ${h.gameName} <small>${h.date}</small></div>`).join('');
}

function renderStats(data) {
    if(!data) return;
    const wins = {};
    Object.values(data).forEach(h => wins[h.winner] = (wins[h.winner]||0)+1);
    document.getElementById('statsList').innerHTML = Object.entries(wins).map(([n, c]) => `
        <div class="card" style="text-align:center"><b>${n}</b><br><span style="color:var(--primary)">${c} Wins</span></div>
    `).join('');
}
function resetPoints() { if(confirm("Reset?")) { state.players.forEach(p=>p.scores=[0]); state.currentDealerIndex=0; pushUpdate(); } }
</script>
</body>
</html>
